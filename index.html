<!doctype html>
<html>
<head>
  <style>
    span + a{
      display:inline-block;
      margin-left:.5em;
    }
  </style>
</head>
<body ng-app='stopgap'>
  <div ng-controller='main as vm'>
    <form>
      <input type='text'>
    </form>
    <ul class='js-todos'>
    </ul>
  </div>
  <script>
  var url = 'https://stopgap.store/8bb3e/todos.json'
  var ul = document.querySelector('.js-todos')
  var form = document.querySelector('form')
  var input = document.querySelector('input')
  form.addEventListener("submit", create)
  document.body.addEventListener("click", remove)
  function remove(event){
   if(event.target.classList.contains("js-delete")){
     event.preventDefault()
     fetch(event.target.href,{
       method: 'DELETE'
     }).then(function(){
       ul.removeChild(event.target.parentNode)
     })
   }
  }
  function create(event){
    event.preventDefault()
    fetch(url,{
      method: 'POST',
      body: JSON.stringify({
        title: input.value
      })
    }).then(function(response){
      input.value = ''
      response.json().then(li)
    })
  }
  function update(event){
    fetch(event.target.getAttribute('url'),{
      method: "PATCH",
      body: JSON.stringify({
	title: event.target.innerText
      })
    })
  }
  fetch(url).then(function(todos){
    todos.json().then(function(ts){
      ts.forEach(li)
    })
  })
  function li(todo){
    var li = document.createElement("li")
    var a = document.createElement("a")
    var span = document.createElement("span")
    span.innerHTML = todo.title
    a.className = 'js-delete'
    a.innerHTML = "&times;"
    a.href = todo.url
    span.setAttribute('contenteditable','true')
    span.setAttribute('url',todo.url)
    li.appendChild(span)
    li.appendChild(a)
    span.addEventListener("blur", update)
    ul.appendChild(li)
  }
  </script>
</body>
</html>